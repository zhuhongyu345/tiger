<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <script type="text/javascript" src="scripts/jquery/jquery-1.7.1.js"></script>
    <link href="style/authority/basic_layout.css" rel="stylesheet" type="text/css">
    <link href="style/authority/common_style.css" rel="stylesheet" type="text/css">
    <title>stock</title>
    <script type="text/javascript">
        var hostC = 'http://82.156.244.4:80'
        $(document).ready(function () {


            $(".ui_input_txt02").keydown(function (e) {
                if (e.keyCode == 13) {
                    search();
                }
            });
            $(".ui_select01").change(function () {
                search();
            });


            $("#deleteSome").click(function () {
                deleteOne();
            });
            $("#flushHard").click(function () {
                flush("1");
            });
            $("#flush").click(function () {
                flush("0");
            });
            $("#addTag").click(function () {
                changeTag("1");
            });
            $("#delTag").click(function () {
                changeTag("0");
            });
            $("#search").click(function () {
                search();
            });
            search();
        });
        function deleteOne(){
            $("input:checkbox").each(function (){
                if ($(this).is(':checked')){
                    checkedValue = $(this).val()
                    console.log(checkedValue)
                    $.ajax({
                        type: "post",
                        url: hostC + "/deleteOne",
                        data: {id: checkedValue},
                        success: function (result) {
                            console.log("flush")
                            console.log(result)
                        }
                    });
                }
            })
            search()
        }
        function changeTag(yn){
            $("input:checkbox").each(function (){
                if ($(this).is(':checked')){
                    checkedValue = $(this).val()
                    console.log(checkedValue)
                    $.ajax({
                        type: "post",
                        url: hostC + "/tagOne",
                        data: {
                            id: checkedValue,
                            tag: yn,
                        },
                        success: function (result) {
                            console.log(checkedValue + ":tag")
                            console.log(result)
                            search()
                        }
                    });
                }
            })
        }
        function flush(hard){
            $.ajax({
                type: "post",
                url: hostC + "/flush",
                data: {
                    hard: hard,
                    type: $("#type").val(),
                },
                success: function (result) {
                    console.log("flush")
                    console.log(result)
                }
            });
        }
        function search() {
            req = {
                size: $("#size").val(),
                skip: $("#skip").val(),
                sortType: $("#sortType").val(),
                sort: $("#sort").val(),
                liangbi: $("#liangbi").val(),
                name: $("#name").val(),
                type: $("#type").val(),
                hlLow: $("#hlLow").val(),
                hlHigh: $("#hlHigh").val(),
                peHigh: $("#peHigh").val(),
                peLow: $("#peLow").val(),
                yield: $("#yield").val(),
                priceLow: $("#priceLow").val(),
                priceHigh: $("#priceHigh").val(),
                cjlHigh: $("#cjlHigh").val(),
                cjlLow: $("#cjlLow").val(),
                zclHigh: $("#zclHigh").val(),
                zclLow: $("#zclLow").val(),


            };
            console.log(req)
            $.ajax({
                type: "post",
                url: hostC + "/search",
                data: req,
                success: function (result) {
                    res = JSON.parse(result)
                    tableBody = '';
                    totc = 0
                    for (var i in res) {
                        totc++
                        d = res[i];
                        t = "未知";
                        bdType = "us-"
                        ftType = "-US"
                         if (d.Type == 2) {
                            t = '美股ETF';
                        }else if (d.Type == 1){
                            t = '美股股票';
                        }else if (d.Type == 3){
                            t = 'A股股票';
                            bdType = "ab-"
                            ftType = "-SH"
                        }
                        link = "https://xueqiu.com/S/" + d.Name
                        linkwn = "https://www.webull.com.sg/ticker/nasdaq-" + d.Name
                        linkwn2 = "https://www.webull.com.sg/ticker/nyse-" + d.Name
                        linkbd = "https://gushitong.baidu.com/stock/" +bdType+ d.Name
                        linkft = "https://www.futunn.com/stock/" + d.Name + ftType
                        linkHistory = "./pe_history.html?name=" + d.Name
                        tableBody += '<tr>' +
                            '<td><input type="checkbox" name="IDCheck" value="'+d.ID+'" class="acb"/></td>' +
                            '<td>' + d.ID + '</td>' +
                            '<td>' + d.Name + '</td>' +
                            '<td>' + d.CHN + '</td>' +
                            '<td>' + t + '</td>' +
                            '<td>' + d.PE + '</td>' +
                            '<td>' + d.Yield + '</td>' +
                            // '<td>' + d.Sz + '</td>' +
                            '<td>' + d.Price + '</td>' +
                            // '<td>' + d.Hsl + '</td>' +
                            // '<td>' + d.Lb + '</td>' +
                            // '<td>' + d.L52 + '</td>' +
                            // '<td>' + d.H52 + '</td>' +
                            '<td>' + d.Hl + '</td>' +
                            '<td>' + d.CjlD + '</td>' +
                            '<td>' + d.ZCL + '</td>' +
                            '<td>' + d.ZCW + '</td>' +
                            '<td>' + d.Up + '</td>' +
                            '<td>' +
                            '<a target="_blank" href="' + linkHistory + '" class="edit">详情</a>' +
                            '</td>' +
                            '<td>' +
                            '<a target="_blank" href="' + linkft + '" class="edit">富途</a>' +
                            // '<a target="_blank" href="' + link + '" class="edit">雪球</a>' +
                            '<a target="_blank" href="' + linkbd + '" class="edit">百度</a>' +
                            '<a target="_blank" href="' + linkwn + '" class="edit">微</a>' +
                            '<a target="_blank" href="' + linkwn2 + '" class="edit">牛</a>' +
                            '</td>' +
                            '</tr>'
                    }
                    $("#tableData").html(tableBody)
                    console.log('count:')
                    console.log(totc)
                }
            });
        }
    </script>
    <style>
        .alt td {
            background: black !important;
        }
    </style>
</head>
<body>

<form id="submitForm" name="submitForm" action="" method="post">
    <div id="container">
        <div class="">
            <div class="ui_text_indent">
                <div id="box_border" style="height: 180px;">
                    <div id="box_top">搜索</div>
                    <div id="box_center">
                        代码<input type="text" id="name" style="width:60px;" class="ui_input_txt02"/>
                        类型
                        <select class="ui_select01" style="width:85px;" id="type">
                            <option value="">全部</option>
                            <option value="-1">自选</option>
                            <option value="1" selected>美股股票</option>
                            <option value="2">美股ETF</option>
                            <option value="3">A股股票</option>
                        </select>
                        &nbsp;&nbsp;高低位<input type="text" id="hlLow" style="width:60px;" class="ui_input_txt02"/>
                        -<input type="text" id="hlHigh" style="width:60px;" class="ui_input_txt02"/>
                        &nbsp;&nbsp;市盈率<input type="text" value="0" id="peLow" style="width:60px;" class="ui_input_txt02"/>
                        -<input type="text" id="peHigh" style="width:60px;" class="ui_input_txt02"/>
                        &nbsp;&nbsp;股息率<input type="text" id="yield" style="width:60px;" class="ui_input_txt02"/>
                        &nbsp;&nbsp;量比<input type="text" id="liangbi" style="width:60px;" class="ui_input_txt02"/>
                        &nbsp;&nbsp;价格<input type="text" id="priceLow" style="width:60px;" class="ui_input_txt02"/>
                        -<input type="text" id="priceHigh" style="width:60px;" class="ui_input_txt02"/>
                         成交率<input type="text" id="cjlLow" style="width:60px;" class="ui_input_txt02"/>
                        -<input type="text" id="cjlHigh" style="width:60px;" class="ui_input_txt02"/>
                         支撑率<input type="text" id="zclLow" style="width:60px;" class="ui_input_txt02"/>
                        -<input type="text" id="zclHigh" style="width:60px;" class="ui_input_txt02"/>
                        &nbsp;&nbsp;排序方式
                        <select class="ui_select01" id="sort" style="width:80px;">
                            <option value="id">默认ID</option>
                            <option value="hl">高低位</option>
                            <option value="pe">市盈率</option>
                            <option value="yield">股息率</option>
                            <option value="liangbi">量比</option>
                            <option value="price">价格</option>
                            <option value="cjlrateday">成交率</option>
                            <option value="zcrate">支撑率</option>
                            <option value="zcweek" selected>周支撑率</option>
                        </select>
                        <select class="ui_select01" id="sortType" style="width:50px;">
                            <option value="asc">正序</option>
                            <option value="desc">倒序</option>
                        </select>
                        skip
                        <input type="text" id="skip" class="ui_input_txt02" style="width:50px;"/>
                        size
                        <input type="text" id="size" class="ui_input_txt02" style="width:50px;" value="1000"/>


                    </div>
                    <div id="box_bottom" style="margin-top: 50px;">
                        <input type="button" style="background-color: limegreen" value="加自选" class="ui_input_btn01" id="addTag"/>
                        <input type="button" style="background-color: mediumvioletred" value="去自选" class="ui_input_btn01" id="delTag"/>
                        <input type="button" style="background-color: palevioletred" value="强制刷新" class="ui_input_btn01" id="flushHard"/>
                        <input type="button" style="background-color: darkred" value="删除所选" class="ui_input_btn01" id="deleteSome"/>
                        <input type="button" style="background-color: limegreen" value="刷新" class="ui_input_btn01" id="flush"/>
                        <input type="button" style="background-color: limegreen" value="查询" class="ui_input_btn01" id="search"/>
                    </div>
                </div>
            </div>
        </div>
        <div class="ui_content">
            <div class="ui_tb">
                <table class="table" cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
                    <tr>
                        <th width="30"><input type="checkbox" id="all" onclick="selectOrClearAllCheckbox(this);"/>
                        </th>
                        <th>ID</th>
                        <th>代码</th>
                        <th style="width:230px;">中文名</th>
                        <th style="width:83px;">类型</th>
                        <th>市盈率</th>
                        <th>股息率</th>
<!--                        <th>市值</th>-->
                        <th>价格</th>
<!--                        <th>换手率</th>-->
<!--                        <th>量比</th>-->
<!--                        <th>52L</th>-->
<!--                        <th>52H</th>-->
                        <th>高低位</th>
                        <th>成交率</th>
                        <th>支撑率</th>
                        <th>周支撑率</th>
                        <th>更新日期</th>
                        <th style="width:39px;">历史</th>
                        <th style="width:103px;">K线</th>
                    </tr>
                    <tbody id="tableData"></tbody>
                </table>
            </div>
        </div>
    </div>
</form>
</body>
</html>
